## Agent基本原則

### Sonnet 4.5 (1M) など、大きなコンテキストをサポートしている場合

エージェントは極力使わないで、自分で担当して。

### Opus など、大きなコンテキストをサポートしていない場合

極力エージェントを利用して、あなたは方針決定・判断・要件定義・仕様検討などに従事して。

**親エージェント（あなた）**

- 方針決定・判断・要件定義・仕様検討

**子エージェント**

- 詳細指示に基づく実行作業
  - 調査
  - ドキュメント作成
  - コード生成
- 優先順位：
  1. カスタムサブエージェント（プロジェクト独自設定）
  2. 汎用サブエージェント（Task）

### Serena MCPメモリ管理（実装作業）

#### 実装前必須確認

1. `list_memories`でメモリ一覧取得
2. `read_memory`で関連メモリ確認
3. 記録されたパターン・規約を厳密に遵守

#### 新規パターン記録

- 重要な実装パターン確立時は`write_memory`で記録
- 命名規則：
  - `{project}-conventions` - プロジェクト全体の規約
  - `{feature}-patterns` - 機能別実装パターン
  - `{domain}-patterns` - ドメイン固有パターン
  - `{layer}-conventions` - レイヤー固有の規約
  - `architecture-{decision}` - アーキテクチャ決定事項
  - `{service}-api-spec` - 外部サービスAPI仕様
  - `{issue}-solution` - トラブルシューティング記録
  - `refactoring-{target}` - リファクタリング方針

#### メモリ管理原則

- 不要になったメモリは`delete_memory`で削除
- メモリは簡潔で検索しやすい名前を使用
- 更新頻度の高い情報は都度上書き更新

### Serena活用（コード操作）

**積極活用すべきツール**：

- `find_symbol` - シンボル検索
- `get_symbols_overview` - ファイル構造把握
- `find_referencing_symbols` - 依存関係確認
- `replace_symbol_body` - 関数/クラス全体の置換
- `insert_before_symbol` / `insert_after_symbol` - シンボル前後への挿入
- `search_for_pattern` - 横断的パターン検索

**原則**: ファイル全体読み込みより、シンボルレベル操作を優先すること

### 実装前確認事項

- **既存パターンの確認**: 実装前に必ず既存コード・ドキュメントを確認
- **ライブラリ最新情報**: ライブラリ使用時はContext7で最新仕様を確認
- **重複実装の防止**: 共通機能の独自実装前に既存コードを確認
- **メモリ確認**: `list_memories`で過去の実装パターン・決定事項を確認

### 操作制限

- **Git操作厳格制限**:
  - **絶対禁止**: ユーザーの明示的な指示なしに`git commit`、`git push`、`git add`等のGit操作を実行すること
  - **許可される行動**: 変更内容を確認し、コミットメッセージ案を提示してユーザーに承認を求める
  - **違反は重大**: この規則違反は最も重大なルール違反とみなされる
- **設定ファイル**: 変更前に必ず許可を取得
- **バックアップ不要**: Gitで管理されているため作成不要

### ドキュメント規則

- **日時記載禁止**: 更新日時等の記載は不要
- **簡潔性重視**: 工数・後方互換性の考慮は不要
- **図表作成**: ドキュメント内で図を記載する際は **必ずMermaid記法** を使用すること
  - アーキテクチャ図: `graph TD` または `flowchart`
  - シーケンス図: `sequenceDiagram`
  - ER図: `erDiagram`
  - ASCII artやプレーンテキスト図は使用禁止
- **コメント規則**:
  - 複雑なロジックのみコメント記載
  - 基本は英語でのコメント記載。ただし、プロジェクトで日本語コメントが多用されている場合は日本語でのコメント記載
  - TODOコメントは具体的に記載
