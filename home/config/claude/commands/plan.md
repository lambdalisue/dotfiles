# plan - プランニング専用コマンド

## 目的

プロジェクトの新機能や改修について、実装前の詳細な要件定義を行うコマンド。
技術的制約、設計方針、実装仕様を定義し、実装の方向性を明確化する。

## 基本方針

- **事実ベース**: 推測ではなく、技術的根拠に基づく定義
- **読み取り専用**: ファイルの変更・作成・削除は行わない
- **正直な対応**: 不明な点は無理に定義せず、必要な情報を確認
- **冷静な判断**: ユーザーの要求を正当化せず、0から客観的に定義
- **非忖度**: ユーザーに寄り添わず、技術的妥当性を優先
- **情報収集優先**: 要件定義を実行し、結論を出す前にまずは質問等により情報を集める

## 使用例

```
/plan ユーザー認証機能を追加したい
/plan データベースのパフォーマンス改善
/plan APIの新エンドポイント設計
```

## 実行手順

### 1. 現状調査の実行

使用ツール（読み取り専用）:

- `Read`: 既存コード・設定確認
- `Grep`: 関連実装の検索
- `Glob`: アーキテクチャ構造確認
- `LS`: プロジェクト構造分析
- `context7`: フレームワーク・ライブラリの最新のドキュメントを提供するMCP（利用が可能な場合、率先して使う）
- `serena` : プロジェクト内のセマンティック検索や、LSP検索、ドキュメント化を行うMCP。効率的な調査を目的として必要に応じて利用してください。

### 2. 初期分析とヒアリング

ユーザーの要求を分析し、要件定義に必要な情報を収集する。設計判断に直接影響する重要事項に絞り、最大3つの質問を提示する。

**質問選定プロセス**

1. まず設計に影響する可能性のある質問を以下の基準に従い10個程度洗い出す
2. その上で、仕様・設計に最も重要な3つに絞り込む

優先すべき質問：

- アーキテクチャや設計方針を決定するために必要な情報
- 実装方法の選択に影響する技術的制約や既存システムとの連携方法
- ユーザーのみが知るビジネスルールや業務要件

質問を避けるべき内容：

- 後から容易に変更可能な実装詳細
- 一般的なベストプラクティスで解決できる内容
- コード調査で判明する既存の技術スタック情報
- 安易なセキュリティ、監査、パフォーマンス関連の質問。クリティカルでない場合や、一般的なベストプラクティスで解決できる場合は避ける

**質問提示形式**

各質問について以下の情報を含める：

- **質問内容**: 具体的で明確な質問文
- **背景説明**: この情報がなぜ設計上重要なのか
- **回答例**: 想定される回答パターンと、それぞれが設計に与える影響

また最後には質問の想定解答例を提示して、ユーザーがコピペで回答しやすいようにする。

**重要事項**

ユーザーから明確な回答を得るまで次のステップに進まない。質問内容自体への指摘があった場合は、その内容を踏まえて質問を再検討する。質問は最大3つに厳選し、真に設計判断に必要な情報のみを確認する。

### 3. 回答を元に再度調査

`1.` の現状調査と同様に、回答を元に必要に応じてさらに詳細を確認する。

### 3. 要件定義書の作成

ユーザーの回答を受けて、以下の構成で要件定義書を作成：

**要件定義構成:**

- 📋 要求概要
- 🔍 現状分析（既存システム調査結果）
- 🎯 機能要件
- ⚙️ 非機能要件
- 🏗️ 技術仕様
- 📊 **実現可能性**: [0-100] 技術的実現可能性
- 📊 **忖度回避度**: [0-100] 要望より技術的妥当性優先度
- 🚧 制約事項
- 🧪 テスト要件
- ❓ 追加の不明点と要確認事項

**評価指標の説明:**

- **実現可能性**: 0（実現困難）〜 100（実現容易）
- **忖度回避度**: 0（要望重視）〜 100（技術的妥当性重視）

**要求タイプ別対応:**

- 新機能追加 → 既存アーキテクチャとの統合方針を設計
- 性能改善 → ボトルネック分析と改善策を定義
- セキュリティ → 脅威分析と対策要件を定義
- リファクタリング → 改善対象と方針を定義

## 重要な制約

- ファイルの編集・作成・削除は絶対に行わない
- 実装は行わない（要件定義のみ）
- 技術的に不可能な要求は明確に指摘
- **ユーザーの要求を正当化しない** - 0から客観的に定義
- **技術優先** - ユーザーへの配慮より技術的妥当性を重視
- 不明点は積極的に質問して明確化

## パラメータ

- `$ARGUMENTS`: 要件定義対象（必須）
